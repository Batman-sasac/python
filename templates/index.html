<!DOCTYPE html>
<html lang="ko">

<head>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <meta charset="UTF-8">
    <title>ìŠ¤ë§ˆíŠ¸ ë³µìŠµ - OCR</title>
    <style>
        .upload-box {
            border: 2px dashed #007bff;
            padding: 20px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* ì´ë¯¸ì§€ í¬ê¸° ì¡°ì ˆ */
        #image-preview {
            display: none;
            margin: 15px auto;
            max-width: 300px;
            max-height: 400px;
            border-radius: 8px;
            object-fit: contain;
        }

        .btn {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            margin: 5px;
        }

        .btn-ocr {
            background: #007bff;
            color: white;
        }

        /* ê²°ê³¼ ì˜ì—­ ë° ê°•ì¡° ìŠ¤íƒ€ì¼ */
        #result-area {
            border: 1px solid #ddd;
            padding: 20px;
            min-height: 200px;
            margin-top: 20px;
            background: white;
            line-height: 1.8;
        }

        /* 1. ê°•ì¡°ëœ ë‹¨ì–´ (strong) ë””ìì¸: ìš°ì„ ìˆœìœ„ë¥¼ ê·¹ëŒ€í™”í•¨ */
        #result-area strong {
            color: #000 !important;
            font-weight: 900 !important;
            background-color: #f0db72 !important;
            /* í˜•ê´‘íœ ë…¸ë€ìƒ‰ */
            padding: 2px 4px !important;
            margin: 0 1px !important;
            border-radius: 4px !important;
            display: inline-block !important;
            /* ë°°ê²½ìƒ‰ì´ ë” ì˜ ë³´ì´ë„ë¡ ì„¤ì • */
            line-height: 1.2 !important;
            text-shadow: none !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
            /* ì‚´ì§ ì…ì²´ê° ì¶”ê°€ */
        }

        /* 2. í‘œ(Table) ë‚´ë¶€ì˜ strong íƒœê·¸ë„ ë™ì¼í•˜ê²Œ ì ìš© */
        #result-area table strong {
            background-color: #f0db72 !important;
            display: inline !important;
            /* í‘œ ì•ˆì—ì„œëŠ” ì¤„ë°”ê¿ˆ ë°©ì§€ë¥¼ ìœ„í•´ inline ìœ ì§€ */
        }

        /* í‘œ ë””ìì¸ */
        #result-area table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        #result-area th,
        #result-area td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: left;
        }

        #result-area th {
            background-color: #f2f2f2;
        }

        .blank-span {
            background: #fff3bf;
            border-bottom: 2px solid #f08c00;
            padding: 0 4px;
            font-weight: bold;
        }

        .quiz-input {
            border: none;
            border-bottom: 2px solid #007bff;
            background: #fff3bf;
            width: 80px;
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2>ğŸ“¸ í•™ìŠµ ì´ë¯¸ì§€ ì—…ë¡œë“œ</h2>
        <div class="upload-box" onclick="document.getElementById('fileInput').click()">
            <p>í´ë¦­í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”.</p>
            <input type="file" id="fileInput" accept="image/*" style="display:none" onchange="previewImage(this)">
            <img id="image-preview" alt="ë¯¸ë¦¬ë³´ê¸°">
        </div>

        <button class="btn btn-ocr" onclick="startOCR()">í…ìŠ¤íŠ¸ ì¶”ì¶œ ì‹œì‘</button>
        <div id="result-area">í…ìŠ¤íŠ¸ê°€ ì¶”ì¶œë˜ë©´ ì´ê³³ì— í‘œì‹œë©ë‹ˆë‹¤.</div>

        <div style="margin-top: 15px;">
            <button class="btn" style="background: #ffc107;" onclick="makeBlank()">ë¹ˆì¹¸ ìƒì„±</button>
            <button class="btn" style="background: #28a745; color: white;" onclick="saveAndStartLearning()">í•™ìŠµ
                ì‹œì‘</button>
        </div>
    </div>

    <script>
        let originalText = "";
        let answerList = [];

        function previewImage(input) {
            const preview = document.getElementById('image-preview');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => { preview.src = e.target.result; preview.style.display = 'block'; };
                reader.readAsDataURL(input.files[0]);
            }
        }

        async function startOCR() {
            const fileInput = document.getElementById('fileInput');
            if (!fileInput.files[0]) return alert("íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”!");

            const formData = new FormData();
            formData.append("file", fileInput.files[0]);

            const resultArea = document.getElementById('result-area');
            // ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ì´ë‚˜ ë©”ì‹œì§€ ê°œì„ 
            resultArea.innerHTML = "<div style='color: #007bff; font-weight: bold;'>ğŸ” ì´ë¯¸ì§€ë¥¼ ì½ê³  í•µì‹¬ ìš©ì–´ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</div>";

            try {
                const res = await fetch("/ocr", { method: "POST", body: formData });
                const data = await res.json();

                if (data.status === "success") {
                    originalText = data.text;
                    // Markdownì„ HTMLë¡œ ë³€í™˜í•˜ì—¬ ë³¼ë“œì²´ ë° í‘œ ë“±ì„ ë Œë”ë§
                    resultArea.innerHTML = marked.parse(data.text);
                    console.log("ë¶„ì„ ì™„ë£Œ");
                } else {
                    resultArea.innerText = "ë¶„ì„ ì‹¤íŒ¨: " + (data.message || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜");
                }
            } catch (e) {
                console.error("OCR ì—ëŸ¬:", e);
                resultArea.innerText = "ì„œë²„ì™€ ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
            }
        }
        function makeBlank() {
            const selection = window.getSelection();
            const selectedText = selection.toString().trim();
            if (!selectedText) return alert("ë‹¨ì–´ë¥¼ ë“œë˜ê·¸í•˜ì„¸ìš”!");

            answerList.push(selectedText);
            const range = selection.getRangeAt(0);
            const span = document.createElement("span");
            span.className = "blank-span";
            span.innerText = `(${answerList.length})`;
            range.deleteContents();
            range.insertNode(span);
            selection.removeAllRanges();
        }

        async function saveAndStartLearning() {
            if (answerList.length === 0) return alert("ë¹ˆì¹¸ì„ ë§Œë“¤ì–´ì£¼ì„¸ìš”!");
            // ì´í›„ ì €ì¥ ë¡œì§...
            alert("í•™ìŠµ ì¤€ë¹„ ì™„ë£Œ!");
        }
    </script>
</body>

</html>